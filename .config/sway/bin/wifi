#!/bin/bash
# Get a list of available wifi connections and morph it into a nice-looking list
iwctl station wlan0 scan; 
wifi_list=$(iwctl station wlan0 get-networks | sed '1,4d' | sed '1s/.\{20\}//' | sed '1s/^./      /' | awk '{print $1}');

# Use rofi to select wifi network
chosen_network=$( echo -e "$wifi_list"  | rofi -dmenu -i -selected-row 1 -p "Wi-Fi SSID");

# Get name of connection
chosen_id=$(echo $chosen_network | xargs);

# Message to show when connection is activated successfully
success_message="You are now connected to the Wi-Fi network \"$chosen_id\".";

# Checking if selected network is in the saved list
saved_connection=$(iwctl known-networks list | sed '1,4d' | sed '1s/^.//' | sed '1s/.\{5\}//' | awk '{print $1}' | grep -w $chosen_id);

#Connecting to the selected network
if [ $saved_connection = $chosen_id ]; 
then 
iwctl station wlan0 connect $chosen_id && 
$( echo -e "$success_message" | rofi -dmenu -p "Connection Established"); 
else 
wifi_password=$(rofi -dmenu -p "Password"); 
iwctl --passphrase $wifi_password station wlan0 connect $chosen_id &&  
$( echo -e "$success_message" | rofi -dmenu -p "Connection Established"); 
fi